<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tank VN - Trò Chơi Đố Vui (Táo Bắc Việt Team)</title>
<link rel="icon" href="favicon.png" type="image/png" />
<style>
  :root{
    --glass-bg: rgba(0,0,0,0.65);
    --accent: #ffcc00;
    --correct: #1db954;
    --wrong: #e53e3e;
    --white: #ffffff;
  }
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;color:var(--white);}
  body{
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    background:#222;
    transition: background 0.5s ease;
  }

  /* Slideshow background container (full-screen) */
  .bg-slideshow{
    position:fixed;
    inset:0;
    z-index:0;
    background:linear-gradient(135deg,#283048,#859398);
    background-size:cover;
    background-position:center;
  }

  /* overlay to dim slideshow */
  .bg-overlay{
    position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:1;
  }

  /* Main card */
  .card{
    position:relative;
    z-index:2;
    width:min(920px,94%);
    max-width:920px;
    background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55));
    border-radius:14px;
    padding:22px;
    box-shadow:0 10px 40px rgba(0,0,0,0.6);
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    align-items:start;
    color:var(--white);
    border:1px solid rgba(255,255,255,0.06);
  }

  /* Left: question area */
  .left {
    padding:12px;
  }
  .logo {
    width:86px; height:86px; object-fit:contain; border-radius:8px; background:rgba(255,255,255,0.06); padding:8px;
  }
  .title { font-size:22px; margin:8px 0 4px 0; color:var(--accent); font-weight:700; }
  .subtitle { font-size:13px; color:rgba(255,255,255,0.85); margin-bottom:12px; }

  /* Question box: black glass */
  .question-box{
    background: var(--glass-bg);
    border-radius:10px;
    padding:18px;
    min-height:160px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap:12px;
    border:1px solid rgba(255,255,255,0.05);
  }
  .question-text{
    color:var(--white);
    font-size:20px;
    line-height:1.25;
    font-weight:600;
  }

  .answer-row{
    display:flex;
    gap:10px;
    align-items:center;
    margin-top:6px;
  }

  input[type="text"]{
    flex:1;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.12);
    background:rgba(255,255,255,0.04);
    color:var(--white);
    outline:none;
    font-size:15px;
  }
  button.btn{
    padding:10px 14px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:#111;
    font-weight:700;
    cursor:pointer;
  }
  button.btn:disabled{opacity:0.6; cursor:not-allowed;}

  .meta {
    display:flex;
    gap:12px;
    margin-top:8px;
    color:rgba(255,255,255,0.85);
    font-size:13px;
    align-items:center;
  }

  /* timer style */
  .timer {
    background: rgba(255,255,255,0.04);
    padding:6px 10px;
    border-radius:8px;
    font-weight:700;
  }

  /* Right: leaderboard & controls */
  .right {
    padding:12px;
  }
  .card-panel{
    background: rgba(255,255,255,0.04);
    padding:12px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.03);
  }
  h3{margin:6px 0 8px 0;}
  ul.leaderboard-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
  ul.leaderboard-list li{
    background: rgba(0,0,0,0.25);
    padding:8px 10px;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:600;
    color:var(--white);
  }

  .small { font-size:13px; color:rgba(255,255,255,0.8); }

  /* Toast (center big) */
  .center-toast{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    z-index:999;
    min-width:320px;
    max-width:90%;
    background:rgba(0,0,0,0.8);
    color:var(--white);
    border-radius:12px;
    padding:18px 20px;
    text-align:center;
    box-shadow:0 12px 40px rgba(0,0,0,0.6);
    border:3px solid rgba(255,255,255,0.06);
    display:none;
  }
  .center-toast.correct{ background: linear-gradient(90deg, rgba(27, 189, 120,0.95), rgba(29,185,144,0.95)); color:#fff;}
  .center-toast.wrong{ background: linear-gradient(90deg, rgba(224,78,78,0.95), rgba(229,62,62,0.95)); color:#fff;}
  .center-toast h2{ margin:0 0 6px 0; font-size:20px; }
  .center-toast p{ margin:0; opacity:0.95; font-weight:600;}
  .center-toast .next-note{ margin-top:10px; font-size:13px; opacity:0.95;}

  /* responsive */
  @media (max-width:860px){
    .card{ grid-template-columns:1fr; max-width:94%; }
    .right{ order:2; }
  }
</style>
</head>
<body>
  <!-- background slideshow -->
  <div id="bg" class="bg-slideshow"></div>
  <div class="bg-overlay"></div>

  <main class="card" role="main">
    <section class="left">
      <img src="logo.png" alt="logo" class="logo" />
      <div class="title">Tank VN — Trò Chơi Đố Vui</div>
      <div class="subtitle">© Táo Bắc Việt Team — Code by Táo Đỏ · Ý tưởng: Táo Xanh Lá · Ảnh: NVT Studio</div>

      <div id="questionArea" class="question-box">
        <div id="questionText" class="question-text">Vui lòng đăng nhập để bắt đầu.</div>

        <div class="answer-row">
          <input id="answerInput" type="text" placeholder="Nhập đáp án..." autocomplete="off" />
          <button id="answerBtn" class="btn">Trả lời</button>
        </div>

        <div class="meta">
          <div id="scoreDisplay" class="small">Điểm: 0 / 100</div>
          <div id="qIndexDisplay" class="small">Câu: 0 / 100</div>
          <div id="timerDisplay" class="timer">⏳ 15s</div>
        </div>
      </div>

    </section>

    <aside class="right">
      <div class="card-panel">
        <h3>Người chơi</h3>
        <div id="loginPanel">
          <input id="playerName" type="text" placeholder="Tên của bạn" />
          <button id="startBtn" class="btn" style="margin-top:8px;">Bắt đầu</button>
        </div>
        <div id="inGameInfo" style="display:none;">
          <div class="small">Người chơi: <strong id="playerNameShow"></strong></div>
          <div style="height:10px"></div>
          <div style="display:flex;gap:8px;">
            <button id="restartBtn" class="btn" style="background:#ff6b6b;">Chơi lại</button>
            <button id="toggleBgmBtn" class="btn" style="background:#6bffb0;">Tắt nhạc</button>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card-panel">
        <h3>Bảng xếp hạng (Top)</h3>
        <ul id="leaderboard" class="leaderboard-list"></ul>
      </div>
    </aside>
  </main>

  <!-- center toast -->
  <div id="centerToast" class="center-toast" role="status" aria-live="polite">
    <h2 id="toastTitle">Đáp án chính xác!</h2>
    <p id="toastMsg">Bạn giành 1 điểm</p>
    <div class="next-note">Chuyển câu tiếp sau <span id="countdown">5</span>s...</div>
  </div>

<script>
/* ===========================
   CONFIG & DATA
   =========================== */
const TOTAL_QUESTIONS = 100;
const SLIDESHOW_INTERVAL_MS = 5000; // change background every 5s
const TOAST_SHOW_SECONDS = 5;       // show toast for 5s before next question
const BG_COUNT = 34;                // number of background images (bg1.jpg ... bg34.jpg)
const BG_PREFIX = 'bg';             // bg1.jpg...
const BG_EXT = '.jpg';              // extension for background images
const TIME_PER_QUESTION = 15;       // seconds per question

const questions = [
  { question: "(1) Nước Văn Lang được thành lập vào thời gian nào?", answer: "2879 TCN" },
  { question: "(2) Nhà nước Âu Lạc ra đời khi nào?", answer: "257 TCN" },
  { question: "(3) An Dương Vương xây thành Cổ Loa vào năm nào?", answer: "208 TCN" },
  { question: "(4) Triệu Đà thành lập nước Nam Việt vào năm nào?", answer: "207 TCN" },
  { question: "(5) Nhà Hán bắt đầu đô hộ Âu Lạc vào năm nào?", answer: "111 TCN" },
  { question: "(6) Khởi nghĩa Hai Bà Trưng bùng nổ vào thời gian nào?", answer: "40" },
  { question: "(7) Hai Bà Trưng thất bại vào năm nào?", answer: "43" },
  { question: "(8) Lý Bí dựng nước Vạn Xuân vào năm nào?", answer: "544" },
  { question: "(9) Nhà Lương đem quân xâm lược nước Vạn Xuân năm nào?", answer: "545" },
  { question: "(10) Triệu Quang Phục đánh thắng quân Lương và giành độc lập năm nào?", answer: "550" },
  { question: "(11) Nhà Tùy xâm lược nước ta vào năm nào?", answer: "602" },
  { question: "(12) Khởi nghĩa Mai Thúc Loan diễn ra năm nào?", answer: "722" },
  { question: "(13) Khởi nghĩa Phùng Hưng nổ ra vào năm nào?", answer: "766" },
  { question: "(14) Dương Đình Nghệ giành quyền tự chủ vào năm nào?", answer: "931" },
  { question: "(15) Trận Bạch Đằng do Ngô Quyền chỉ huy diễn ra khi nào?", answer: "25/12/0938" },
  { question: "(16) Ngô Quyền mất năm nào?", answer: "944" },
  { question: "(17) Loạn 12 sứ quân xảy ra vào năm nào?", answer: "966" },
  { question: "(18) Đinh Bộ Lĩnh dẹp loạn 12 sứ quân, lập nhà Đinh năm nào?", answer: "968" },
  { question: "(19) Đinh Tiên Hoàng lên ngôi Hoàng đế khi nào?", answer: "968" },
  { question: "(20) Năm nào dời đô về Hoa Lư?", answer: "968" },
  { question: "(21) Đinh Tiên Hoàng và con trai bị ám sát vào năm nào?", answer: "979" },
  { question: "(22) Lê Hoàn lên ngôi, lập nhà Tiền Lê vào năm nào?", answer: "980" },
  { question: "(23) Quân Tống xâm lược Đại Cồ Việt lần thứ nhất năm nào?", answer: "981" },
  { question: "(24) Lý Công Uẩn dời đô từ Hoa Lư ra Thăng Long khi nào?", answer: "1010" },
  { question: "(25) Nhà Lý đổi quốc hiệu từ Đại Cồ Việt thành Đại Việt khi nào?", answer: "1054" },
  { question: "(26) Lý Thường Kiệt đánh bại quân Tống xâm lược vào năm nào?", answer: "1077" },
  { question: "(27) Bài thơ “Nam quốc sơn hà” được đọc trong trận Như Nguyệt vào năm nào?", answer: "1077" },
  { question: "(28) Nhà Trần được thành lập vào năm nào?", answer: "1226" },
  { question: "(29) Nhà Trần đánh thắng quân Nguyên lần thứ nhất khi nào?", answer: "1258" },
  { question: "(30) Trận Bạch Đằng do Trần Hưng Đạo chỉ huy diễn ra khi nào?", answer: "09/04/1288" },
  { question: "(31) Nhà Hồ được thành lập năm nào?", answer: "1400" },
  { question: "(32) Quân Minh xâm lược nước ta vào năm nào?", answer: "1407" },
  { question: "(33) Khởi nghĩa Lam Sơn nổ ra năm nào?", answer: "1418" },
  { question: "(34) Lê Lợi lên ngôi vua, lập nhà Hậu Lê năm nào?", answer: "1428" },
  { question: "(35) Bộ luật Hồng Đức được ban hành vào năm nào?", answer: "1483" },
  { question: "(36) Nhà Mạc thành lập khi nào?", answer: "1527" },
  { question: "(37) Chiến tranh Nam – Bắc triều diễn ra vào khoảng thời gian nào?", answer: "1545–1592" },
  { question: "(38) Trịnh – Nguyễn phân tranh bắt đầu khi nào?", answer: "1627" },
  { question: "(39) Trịnh – Nguyễn hòa hoãn vào năm nào?", answer: "1672" },
  { question: "(40) Phong trào Tây Sơn bùng nổ năm nào?", answer: "1771" },
  { question: "(41) Nguyễn Huệ đánh tan quân Xiêm ở Rạch Gầm – Xoài Mút khi nào?", answer: "19/01/1785" },
  { question: "(42) Nguyễn Huệ lên ngôi Hoàng đế, lấy hiệu Quang Trung năm nào?", answer: "1788" },
  { question: "(43) Trận Ngọc Hồi – Đống Đa diễn ra khi nào?", answer: "05/01/1789" },
  { question: "(44) Nhà Nguyễn được thành lập khi nào?", answer: "1802" },
  { question: "(45) Kinh đô Huế được xây dựng hoàn tất năm nào?", answer: "1832" },
  { question: "(46) Pháp tấn công Đà Nẵng khi nào?", answer: "01/09/1858" },
  { question: "(47) Pháp chiếm thành Gia Định năm nào?", answer: "02/1859" },
  { question: "(48) Hiệp ước Nhâm Tuất được ký khi nào?", answer: "05/06/1862" },
  { question: "(49) Pháp chiếm nốt 3 tỉnh miền Tây Nam Kỳ khi nào?", answer: "20/06/1867" },
  { question: "(50) Phong trào Cần Vương bùng nổ khi nào?", answer: "13/07/1885" },
  { question: "(51) Khởi nghĩa Yên Thế do Hoàng Hoa Thám lãnh đạo diễn ra năm nào?", answer: "1884–1913" },
  { question: "(52) Phong trào Đông Du bắt đầu năm nào?", answer: "1905" },
  { question: "(53) Đông Kinh Nghĩa Thục được thành lập năm nào?", answer: "1907" },
  { question: "(54) Nguyễn Ái Quốc ra đi tìm đường cứu nước khi nào?", answer: "05/06/1911" },
  { question: "(55) Nguyễn Ái Quốc gửi bản Yêu sách tới Hội nghị Versailles năm nào?", answer: "06/1919" },
  { question: "(56) Nguyễn Ái Quốc tham dự Quốc tế Cộng sản lần thứ V khi nào?", answer: "06/1923" },
  { question: "(57) Hội Việt Nam Cách mạng Thanh niên được thành lập khi nào?", answer: "06/1925" },
  { question: "(58) Tác phẩm “Đường Kách Mệnh” ra đời năm nào?", answer: "1927" },
  { question: "(59) Đông Dương Cộng sản Đảng thành lập khi nào?", answer: "06/1929" },
  { question: "(60) Đảng Cộng sản Việt Nam ra đời khi nào?", answer: "03/02/1930" },
  { question: "(61) Luận cương chính trị được thông qua vào năm nào?", answer: "10/1930" },
  { question: "(62) Khởi nghĩa Nam Kỳ nổ ra khi nào?", answer: "23/11/1940" },
  { question: "(63) Cách mạng Tháng Tám diễn ra vào thời gian nào?", answer: "19/08/1945" },
  { question: "(64) Nước Việt Nam Dân chủ Cộng hòa được thành lập khi nào?", answer: "02/09/1945" },
  { question: "(65) Hiệp định Sơ bộ Việt – Pháp được ký khi nào?", answer: "06/03/1946" },
  { question: "(66) Toàn quốc kháng chiến bùng nổ khi nào?", answer: "19/12/1946" },
  { question: "(67) Chiến thắng Biên giới diễn ra khi nào?", answer: "09/1950" },
  { question: "(68) Chiến dịch Điện Biên Phủ bắt đầu khi nào?", answer: "13/03/1954" },
  { question: "(69) Chiến thắng Điện Biên Phủ kết thúc khi nào?", answer: "07/05/1954" },
  { question: "(70) Hiệp định Giơnevơ được ký khi nào?", answer: "21/07/1954" },
  { question: "(71) Miền Bắc hoàn toàn giải phóng khi nào?", answer: "1955" },
  { question: "(72) Mặt trận Dân tộc Giải phóng miền Nam thành lập khi nào?", answer: "20/12/1960" },
  { question: "(73) Phong trào Đồng khởi bùng nổ khi nào?", answer: "01/1960" },
  { question: "(74) Chiến thắng Ấp Bắc diễn ra khi nào?", answer: "02/01/1963" },
  { question: "(75) Chiến dịch Mậu Thân diễn ra khi nào?", answer: "31/01/1968" },
  { question: "(76) Mỹ ngừng ném bom miền Bắc khi nào?", answer: "11/1968" },
  { question: "(77) Chiến thắng Đường 9 – Nam Lào diễn ra khi nào?", answer: "02/1971" },
  { question: "(78) Hiệp định Paris về chấm dứt chiến tranh ở Việt Nam được ký khi nào?", answer: "27/01/1973" },
  { question: "(79) Chiến dịch Hồ Chí Minh bắt đầu khi nào?", answer: "26/04/1975" },
  { question: "(80) Giải phóng hoàn toàn miền Nam khi nào?", answer: "30/04/1975" },
  { question: "(81) Nước Cộng hòa Xã hội Chủ nghĩa Việt Nam thành lập khi nào?", answer: "02/07/1976" },
  { question: "(82) Việt Nam gia nhập Liên Hợp Quốc khi nào?", answer: "20/09/1977" },
  { question: "(83) Hiến pháp 1980 được thông qua khi nào?", answer: "18/12/1980" },
  { question: "(84) Đại hội VI của Đảng diễn ra khi nào?", answer: "12/1986" },
  { question: "(85) Chính sách Đổi mới được khởi xướng khi nào?", answer: "12/1986" },
  { question: "(86) Việt Nam rút quân khỏi Campuchia khi nào?", answer: "09/1989" },
  { question: "(87) Việt Nam gia nhập ASEAN khi nào?", answer: "28/07/1995" },
  { question: "(88) Ký Hiệp định Thương mại Việt – Mỹ khi nào?", answer: "13/07/2000" },
  { question: "(89) Việt Nam gia nhập WTO khi nào?", answer: "11/01/2007" },
  { question: "(90) Việt Nam tổ chức APEC lần đầu tiên khi nào?", answer: "2006" },
  { question: "(91) Đại tướng Võ Nguyên Giáp qua đời khi nào?", answer: "04/10/2013" },
  { question: "(92) Việt Nam đăng cai APEC lần thứ hai khi nào?", answer: "2017" },
  { question: "(93) Hiệp định CPTPP có hiệu lực tại Việt Nam khi nào?", answer: "14/01/2019" },
  { question: "(94) Việt Nam đảm nhận vai trò Chủ tịch ASEAN khi nào?", answer: "2020" },
  { question: "(95) Đại dịch COVID-19 bùng phát tại Việt Nam khi nào?", answer: "23/01/2020" },
  { question: "(96) Quốc hội khóa XV được bầu khi nào?", answer: "23/05/2021" },
  { question: "(97) Việt Nam tổ chức SEA Games 31 khi nào?", answer: "12/05/2022" },
  { question: "(98) Kỷ niệm 100 năm ngày sinh Đại tướng Võ Nguyên Giáp khi nào?", answer: "25/08/2011" },
  { question: "(99) Ngày Giải phóng Thủ đô là khi nào?", answer: "10/10/1954" },
  { question: "(100) Việt Nam trở thành Ủy viên HĐBA LHQ nhiệm kỳ 2020–2021 khi nào?", answer: "2019" },
    { question: "(101) Ngô Quyền dựng cọc gỗ chuẩn bị trận Bạch Đằng khi nào?", answer: "10/938" },
  { question: "(102) Nhà Tiền Lê đổi niên hiệu là gì vào năm nào?", answer: "Thiên Phúc – 980" },
  { question: "(103) Nhà Lý lập Văn Miếu Quốc Tử Giám khi nào?", answer: "1070" },
  { question: "(104) Trần Thái Tông lên ngôi Hoàng đế khi nào?", answer: "1226" },
  { question: "(105) Nhà Trần tổ chức Hội nghị Diên Hồng khi nào?", answer: "1284" },
  { question: "(106) Quân Nguyên xâm lược Đại Việt lần thứ hai khi nào?", answer: "1285" },
  { question: "(107) Hồ Quý Ly dời đô về Tây Đô khi nào?", answer: "1397" },
  { question: "(108) Lê Lợi khởi nghĩa tại Lam Sơn thuộc Thanh Hóa khi nào?", answer: "1418" },
  { question: "(109) Nguyễn Trãi viết Bình Ngô Đại Cáo khi nào?", answer: "1428" },
  { question: "(110) Nguyễn Huệ kéo quân ra Bắc lần đầu khi nào?", answer: "06/1786" },
  { question: "(111) Nguyễn Ánh lên ngôi lấy niên hiệu Gia Long khi nào?", answer: "1802" },
  { question: "(112) Triều Nguyễn chia đất nước thành 6 tỉnh Nam Kỳ khi nào?", answer: "1832" },
  { question: "(113) Phong trào Văn Thân bùng nổ khi nào?", answer: "1874" },
  { question: "(114) Phong trào chống thuế ở Trung Kỳ diễn ra năm nào?", answer: "1908" },
  { question: "(115) Nguyễn Tất Thành vào học Trường Quốc học Huế khi nào?", answer: "1908" },
  { question: "(116) Nguyễn Ái Quốc gia nhập Đảng Xã hội Pháp khi nào?", answer: "12/1918" },
  { question: "(117) Nguyễn Ái Quốc tham gia sáng lập Đảng Cộng sản Pháp khi nào?", answer: "25/12/1920" },
  { question: "(118) Nguyễn Ái Quốc lấy tên Hồ Chí Minh khi nào?", answer: "1942" },
  { question: "(119) Hội nghị Trung ương 8 (quyết định thành lập Việt Minh) diễn ra khi nào?", answer: "05/1941" },
  { question: "(120) Hồ Chí Minh trở về Pác Bó (Cao Bằng) hoạt động khi nào?", answer: "28/01/1941" },
  { question: "(121) Tổng khởi nghĩa Tháng Tám thắng lợi ở Hà Nội khi nào?", answer: "19/08/1945" },
  { question: "(122) Lễ Tuyên ngôn Độc lập diễn ra ở Ba Đình vào ngày nào?", answer: "02/09/1945" },
  { question: "(123) Cuộc bầu cử Quốc hội đầu tiên của Việt Nam diễn ra khi nào?", answer: "06/01/1946" },
  { question: "(124) Quân Pháp tấn công Hà Nội, mở đầu toàn quốc kháng chiến khi nào?", answer: "19/12/1946" },
  { question: "(125) Hồ Chí Minh đọc lời kêu gọi toàn quốc kháng chiến khi nào?", answer: "20/12/1946" },
  { question: "(126) Chiến thắng Việt Bắc diễn ra năm nào?", answer: "1947" },
  { question: "(127) Chiến dịch Biên giới do Đại tướng Võ Nguyên Giáp chỉ huy khi nào?", answer: "09/1950" },
  { question: "(128) Hồ Chủ tịch sang thăm Trung Quốc và Liên Xô lần đầu khi nào?", answer: "1950" },
  { question: "(129) Quân ta thắng lớn tại Điện Biên Phủ khi nào?", answer: "07/05/1954" },
  { question: "(130) Hiệp định Giơnevơ chia Việt Nam tạm thời thành hai miền khi nào?", answer: "21/07/1954" },
  { question: "(131) Chính quyền Ngô Đình Diệm thành lập ở miền Nam khi nào?", answer: "1955" },
  { question: "(132) Miền Bắc bước vào kế hoạch 5 năm lần thứ nhất khi nào?", answer: "1961" },
  { question: "(133) Quân Mỹ đổ bộ vào Đà Nẵng khi nào?", answer: "08/03/1965" },
  { question: "(134) Chiến dịch Mậu Thân nổ ra khi nào?", answer: "31/01/1968" },
  { question: "(135) Chiến dịch Đường 9 – Nam Lào diễn ra khi nào?", answer: "02/1971" },
  { question: "(136) Hiệp định Paris được ký kết khi nào?", answer: "27/01/1973" },
  { question: "(137) Chiến dịch Hồ Chí Minh mở màn ngày nào?", answer: "26/04/1975" },
  { question: "(138) Giải phóng hoàn toàn miền Nam khi nào?", answer: "30/04/1975" },
  { question: "(139) Miền Nam được thống nhất về mặt nhà nước khi nào?", answer: "02/07/1976" },
  { question: "(140) Hiến pháp mới được ban hành khi nào?", answer: "18/12/1980" },
  { question: "(141) Việt Nam thực hiện chính sách Đổi mới khi nào?", answer: "12/1986" },
  { question: "(142) Việt Nam và Trung Quốc bình thường hóa quan hệ khi nào?", answer: "02/1991" },
  { question: "(143) Đại hội VII của Đảng thông qua Cương lĩnh xây dựng đất nước khi nào?", answer: "06/1991" },
  { question: "(144) Việt Nam gia nhập ASEAN khi nào?", answer: "28/07/1995" },
  { question: "(145) Việt Nam gia nhập APEC khi nào?", answer: "1998" },
  { question: "(146) Việt Nam ký Hiệp định Thương mại song phương với Mỹ khi nào?", answer: "13/07/2000" },
  { question: "(147) Việt Nam chính thức gia nhập WTO khi nào?", answer: "11/01/2007" },
  { question: "(148) Việt Nam đăng cai Hội nghị APEC lần đầu khi nào?", answer: "2006" },
  { question: "(149) Việt Nam trúng cử Ủy viên không thường trực HĐBA LHQ nhiệm kỳ 2008–2009 khi nào?", answer: "16/10/2007" },
  { question: "(150) Việt Nam đảm nhiệm vai trò Chủ tịch ASEAN lần đầu khi nào?", answer: "2010" },
  { question: "(151) Đại tướng Võ Nguyên Giáp từ trần khi nào?", answer: "04/10/2013" },
  { question: "(152) Việt Nam đăng cai Hội nghị APEC lần thứ hai khi nào?", answer: "2017" },
  { question: "(153) CPTPP chính thức có hiệu lực tại Việt Nam khi nào?", answer: "14/01/2019" },
  { question: "(154) Việt Nam giữ vai trò Chủ tịch ASEAN lần thứ hai khi nào?", answer: "2020" },
  { question: "(155) Việt Nam trở thành Ủy viên HĐBA LHQ nhiệm kỳ 2020–2021 khi nào?", answer: "07/06/2019" },
  { question: "(156) Dịch COVID-19 xuất hiện tại Việt Nam khi nào?", answer: "23/01/2020" },
  { question: "(157) Việt Nam tổ chức SEA Games 31 khi nào?", answer: "12/05/2022" },
  { question: "(158) Chiến thắng Bạch Đằng của Trần Hưng Đạo diễn ra khi nào?", answer: "09/04/1288" },
  { question: "(159) Hội nghị thành lập Đảng Cộng sản Việt Nam diễn ra ở đâu và khi nào?", answer: "Hồng Kông – 03/02/1930" },
  { question: "(160) Hồ Chí Minh về nước lần cuối cùng khi nào?", answer: "28/01/1941" },
  { question: "(161) Cách mạng Tháng Tám bắt đầu từ địa phương nào và khi nào?", answer: "Bắc Giang – 17/08/1945" },
  { question: "(162) Việt Nam mở đầu thời kỳ Đổi mới bằng Đại hội nào?", answer: "Đại hội VI – 12/1986" },
  { question: "(163) Việt Nam trúng cử HĐBA LHQ nhiệm kỳ 2008–2009 khi nào?", answer: "16/10/2007" },
  { question: "(164) Việt Nam gia nhập Liên Hợp Quốc khi nào?", answer: "20/09/1977" },
  { question: "(165) Hiệp định Genève ký kết chấm dứt chiến tranh Đông Dương khi nào?", answer: "21/07/1954" },
  { question: "(166) Phong trào Xô Viết Nghệ Tĩnh bùng nổ khi nào?", answer: "09/1930" },
  { question: "(167) Hội nghị Trung ương 15 (mở rộng) của Đảng đề ra đường lối cách mạng miền Nam khi nào?", answer: "01/1959" },
  { question: "(168) Hồ Chí Minh gửi thư kêu gọi toàn quốc chống Mỹ khi nào?", answer: "17/07/1966" },
  { question: "(169) Chiến dịch Điện Biên Phủ trên không diễn ra khi nào?", answer: "18/12/1972" },
  { question: "(170) Việt Nam – Mỹ bình thường hóa quan hệ khi nào?", answer: "11/07/1995" },
  { question: "(171) Việt Nam gia nhập Liên minh châu Á – Thái Bình Dương về giáo dục khi nào?", answer: "1993" },
  { question: "(172) Việt Nam tham gia Hội đồng Nhân quyền LHQ lần đầu khi nào?", answer: "12/11/2013" },
  { question: "(173) Hồ Chí Minh từ trần khi nào?", answer: "02/09/1969" },
  { question: "(174) Nhà Nguyễn ban hành bộ Hoàng Việt luật lệ khi nào?", answer: "1815" },
  { question: "(175) Phong trào Duy Tân do Phan Châu Trinh khởi xướng khi nào?", answer: "1906" },
  { question: "(176) Việt Nam ký Hiệp định Pa-ri chấm dứt chiến tranh khi nào?", answer: "27/01/1973" },
  { question: "(177) Đại hội VII của Đảng diễn ra khi nào?", answer: "06/1991" },
  { question: "(178) Việt Nam được công nhận là nền kinh tế thị trường khi nào?", answer: "2006" },
  { question: "(179) Đại hội XIII của Đảng diễn ra khi nào?", answer: "01/2021" },
  { question: "(180) Chiến dịch Tây Bắc được mở vào thời gian nào?", answer: "09/1952" },
  { question: "(181) Phong trào “Bình dân học vụ” bắt đầu khi nào?", answer: "08/09/1945" },
  { question: "(182) Quốc khánh nước Việt Nam Dân chủ Cộng hòa lần đầu tổ chức khi nào?", answer: "02/09/1946" },
  { question: "(183) Hồ Chủ tịch phát động Tết trồng cây đầu tiên khi nào?", answer: "28/11/1959" },
  { question: "(184) Ngày Thống nhất đất nước được chọn là ngày lễ nào?", answer: "30/04/1975" },
  { question: "(185) Việt Nam đăng cai ASIAD 18 khi nào?", answer: "2018" },
  { question: "(186) Nhà nước Đại Việt ra đời khi nào?", answer: "1054" },
  { question: "(187) Nguyễn Huệ đại phá quân Thanh ở Ngọc Hồi – Đống Đa khi nào?", answer: "05/01/1789" },
  { question: "(188) Việt Nam tổ chức SEA Games lần đầu khi nào?", answer: "2003" },
  { question: "(189) Việt Nam trúng cử HĐBA LHQ nhiệm kỳ 2023–2024 khi nào?", answer: "06/06/2022" },
  { question: "(190) Việt Nam tổ chức Hội nghị cấp cao Mỹ – Triều khi nào?", answer: "27/02/2019" },
  { question: "(191) Hồ Chí Minh viết Di chúc vào thời gian nào?", answer: "05/1969" },
  { question: "(192) Việt Nam trở thành thành viên chính thức của Liên minh Nghị viện Thế giới khi nào?", answer: "1979" },
  { question: "(193) Việt Nam đăng cai Hội nghị ASEM lần đầu khi nào?", answer: "2004" },
  { question: "(194) Việt Nam chính thức ký EVFTA với EU khi nào?", answer: "30/06/2019" },
  { question: "(195) Việt Nam tổ chức bầu cử Quốc hội khóa XV khi nào?", answer: "23/05/2021" },
  { question: "(196) Việt Nam đăng cai SEA Games 22 khi nào?", answer: "2003" },
  { question: "(197) Việt Nam gia nhập tổ chức CPTPP khi nào?", answer: "14/01/2019" },
  { question: "(198) Việt Nam ký kết RCEP khi nào?", answer: "15/11/2020" },
  { question: "(199) Đại lễ 1000 năm Thăng Long – Hà Nội diễn ra khi nào?", answer: "10/2010" },
  { question: "(200) Hồ Chí Minh sinh ra khi nào?", answer: "19/05/1890" }
];



/* ===========================
   STATE
   =========================== */
let currentIndex = 0;
let score = 0;
let playerName = '';
let answeringLocked = false;
let toastTimer = null;
let toastCountdownTimer = null;

/* timer */
let questionTimer = null;
let timeLeft = TIME_PER_QUESTION;

/* bg slideshow */
let bgIndex = 1;

/* audio */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = AudioCtx ? new AudioCtx() : null;
let bgm = null;
let bgmPlaying = false;

/* ===========================
   DOM refs
   =========================== */
const bgEl = document.getElementById('bg');
const qText = document.getElementById('questionText');
const answerInput = document.getElementById('answerInput');
const answerBtn = document.getElementById('answerBtn');
const scoreDisplay = document.getElementById('scoreDisplay');
const qIndexDisplay = document.getElementById('qIndexDisplay');
const timerDisplay = document.getElementById('timerDisplay');

const startBtn = document.getElementById('startBtn');
const playerNameInput = document.getElementById('playerName');
const playerNameShow = document.getElementById('playerNameShow');
const restartBtn = document.getElementById('restartBtn');
const loginPanel = document.getElementById('loginPanel');
const inGameInfo = document.getElementById('inGameInfo');
const toggleBgmBtn = document.getElementById('toggleBgmBtn');

const centerToast = document.getElementById('centerToast');
const toastTitle = document.getElementById('toastTitle');
const toastMsg = document.getElementById('toastMsg');
const countdownEl = document.getElementById('countdown');

const leaderboardEl = document.getElementById('leaderboard');

/* ===========================
   AUDIO: Web Audio simple beeps
   =========================== */
function beep(frequency=440, duration=150, type='sine', ramp=0.02){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = frequency;
  g.gain.setValueAtTime(0, audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(0.12, audioCtx.currentTime + ramp);
  g.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime + duration/1000);
  o.connect(g);
  g.connect(audioCtx.destination);
  o.start();
  setTimeout(()=>{ try{o.stop()}catch(e){} }, duration+20);
}

function playCorrect(){
  if(audioCtx && audioCtx.state === 'suspended'){ try{ audioCtx.resume(); }catch(e){} }
  beep(880,90); setTimeout(()=>beep(1100,70),90);
}
function playWrong(){
  if(audioCtx && audioCtx.state === 'suspended'){ try{ audioCtx.resume(); }catch(e){} }
  beep(240,300,'square');
}

/* ===========================
   BACKGROUND SLIDESHOW
   =========================== */
function setBgImage(i){
  const url = `${BG_PREFIX}${i}${BG_EXT}`;
  bgEl.style.background = `url("${url}") center/cover no-repeat`;
}
function startSlideshow(){
  setBgImage(bgIndex);
  setInterval(()=>{
    bgIndex++;
    if(bgIndex>BG_COUNT) bgIndex = 1;
    setBgImage(bgIndex);
  }, SLIDESHOW_INTERVAL_MS);
}

/* ===========================
   BGM control
   =========================== */
function initBgm(){
  if(!bgm){
    bgm = new Audio("Task.mp3");
    bgm.loop = true;
    bgm.volume = 0.33;
    bgm.preload = 'auto';
  }
}
function playBgm(){
  if(!bgm) initBgm();
  // resume audio context if present (for beep sounds)
  if(audioCtx && audioCtx.state === 'suspended'){
    audioCtx.resume().catch(()=>{});
  }
  bgm.play().then(()=>{ bgmPlaying = true; toggleBgmBtn.textContent = 'Tắt nhạc'; })
  .catch(()=>{ /* autoplay blocked, will resume on user gesture */ });
}
function pauseBgm(){
  if(bgm){ bgm.pause(); bgmPlaying = false; toggleBgmBtn.textContent = 'Mở nhạc'; }
}

/* ===========================
   UI helpers
   =========================== */
function updateUI(){
  scoreDisplay.textContent = `Điểm: ${score} / ${TOTAL_QUESTIONS}`;
  qIndexDisplay.textContent = `Câu: ${Math.min(currentIndex+1,TOTAL_QUESTIONS)} / ${TOTAL_QUESTIONS}`;
}

function showQuestion(idx){
  const q = questions[idx];
  qText.textContent = q.question;
  answerInput.value = '';
  answerInput.focus();
  updateUI();
  answeringLocked = false;
  answerBtn.disabled = false;
  answerInput.disabled = false;
  startQuestionTimer();
}

/* ===========================
   TIMER: per-question countdown
   =========================== */
function startQuestionTimer(){
  clearInterval(questionTimer);
  timeLeft = TIME_PER_QUESTION;
  timerDisplay.textContent = `⏳ ${timeLeft}s`;
  questionTimer = setInterval(()=>{
    timeLeft--;
    if(timeLeft < 0) timeLeft = 0;
    timerDisplay.textContent = `⏳ ${timeLeft}s`;
    if(timeLeft <= 0){
      clearInterval(questionTimer);
      handleTimeUp();
    }
  },1000);
}
function stopQuestionTimer(){
  clearInterval(questionTimer);
}

/* ===========================
   ANSWER FLOW
   =========================== */
function onAnswerSubmit(){
  if(answeringLocked) return;
  answeringLocked = true;
  stopQuestionTimer();
  const user = (answerInput.value || '').trim();
  const correct = (questions[currentIndex].answer || '').trim();

  const normalize = s => s.replace(/\s+/g,' ').trim().toLowerCase();
  const isCorrect = normalize(user) === normalize(correct);

  // clear any existing toast timers
  clearToastTimers();

  if(isCorrect){
    score += 1;            // each question 1 điểm
    playCorrect();
    showCenterToast("Đáp án chính xác", `+1 điểm`, true, TOAST_SHOW_SECONDS);
  } else {
    playWrong();
    showCenterToast("Sai rồi", `Đáp án đúng: ${correct}`, false, TOAST_SHOW_SECONDS);
  }

  updateUI();
  answerBtn.disabled = true;
  answerInput.disabled = true;

  // countdown inside toast
  let remaining = TOAST_SHOW_SECONDS;
  countdownEl.textContent = remaining;
  toastCountdownTimer = setInterval(()=>{
    remaining--;
    if(remaining>=0) countdownEl.textContent = remaining;
  },1000);

  toastTimer = setTimeout(()=>{ proceedToNextAfterToast(); }, TOAST_SHOW_SECONDS*1000);
}

/* called when time runs out */
function handleTimeUp(){
  if(answeringLocked) return;
  answeringLocked = true;
  const correct = (questions[currentIndex].answer || '').trim();
  playWrong();
  showCenterToast("Hết giờ!", `Đáp án đúng: ${correct}`, false, TOAST_SHOW_SECONDS);

  // disable input
  answerBtn.disabled = true;
  answerInput.disabled = true;

  // countdown inside toast
  clearToastTimers();
  let remaining = TOAST_SHOW_SECONDS;
  countdownEl.textContent = remaining;
  toastCountdownTimer = setInterval(()=>{
    remaining--;
    if(remaining>=0) countdownEl.textContent = remaining;
  },1000);

  toastTimer = setTimeout(()=>{ proceedToNextAfterToast(); }, TOAST_SHOW_SECONDS*1000);
}

/* proceed to next question (used by both onAnswerSubmit and time up) */
function proceedToNextAfterToast(){
  clearToastTimers();
  hideCenterToast();
  currentIndex++;
  answeringLocked = false;
  answerInput.disabled = false;
  if(currentIndex < TOTAL_QUESTIONS && currentIndex < questions.length){
    showQuestion(currentIndex);
  } else {
    endGame();
  }
}

/* clear existing toast timers */
function clearToastTimers(){
  if(toastTimer){ clearTimeout(toastTimer); toastTimer = null; }
  if(toastCountdownTimer){ clearInterval(toastCountdownTimer); toastCountdownTimer = null; }
}

/* ===========================
   Center toast controls
   =========================== */
function showCenterToast(title, msg, correct, seconds){
  centerToast.style.display = 'block';
  centerToast.classList.remove('correct','wrong');
  centerToast.classList.add(correct ? 'correct' : 'wrong');
  toastTitle.textContent = title;
  toastMsg.textContent = msg;
  countdownEl.textContent = seconds;
}
function hideCenterToast(){
  centerToast.style.display = 'none';
}

/* ===========================
   Leaderboard (localStorage)
   =========================== */
const LB_KEY = 'tankvn_leaderboard';
function saveScore(name, sc){
  if(!name) name = 'Người chơi';
  const list = JSON.parse(localStorage.getItem(LB_KEY) || '[]');
  list.push({ name, score: sc, date: (new Date()).toISOString() });
  list.sort((a,b)=> b.score - a.score);
  localStorage.setItem(LB_KEY, JSON.stringify(list.slice(0,20)));
}
function updateLeaderboard(){
  const list = JSON.parse(localStorage.getItem(LB_KEY) || '[]');
  leaderboardEl.innerHTML = '';
  if(list.length===0){
    const li = document.createElement('li');
    li.textContent = 'Chưa có ai ghi điểm';
    leaderboardEl.appendChild(li);
    return;
  }
  list.slice(0,10).forEach((entry, idx)=>{
    const li = document.createElement('li');
    li.innerHTML = `<span>${idx+1}. ${entry.name}</span><strong>${entry.score} điểm</strong>`;
    leaderboardEl.appendChild(li);
  });
}

/* ===========================
   START / RESTART handlers
   =========================== */
startBtn.addEventListener('click', ()=>{
  const val = (playerNameInput.value || '').trim();
  if(!val) { alert('Vui lòng nhập tên của bạn'); playerNameInput.focus(); return; }
  playerName = val;
  playerNameShow.textContent = playerName;
  loginPanel.style.display = 'none';
  inGameInfo.style.display = 'block';
  currentIndex = 0;
  score = 0;
  updateLeaderboard();
  updateUI();
  showQuestion(currentIndex);

  // enable inputs now, ensure audio context resume and start bgm
  if(audioCtx && audioCtx.state === 'suspended'){
    audioCtx.resume().catch(()=>{});
  }
  playBgm();

  // Ensure answer input is focused
  setTimeout(()=>{ answerInput.focus(); }, 100);
});

restartBtn.addEventListener('click', ()=>{
  // reset but keep player name
  playerName = playerName || 'Người chơi';
  playerNameShow.textContent = playerName;
  currentIndex = 0;
  score = 0;
  updateUI();
  hideCenterToast();
  clearToastTimers();
  stopQuestionTimer();
  showQuestion(currentIndex);
  if(!bgmPlaying) playBgm();
});

/* toggle background music */
toggleBgmBtn.addEventListener('click', ()=>{
  if(bgmPlaying){ pauseBgm(); }
  else { playBgm(); }
});

/* catch Enter key on input to submit */
answerInput.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ e.preventDefault(); onAnswerSubmit(); }
});
answerBtn.addEventListener('click', onAnswerSubmit);

/* ===========================
   End game
   =========================== */
function endGame(){
  stopQuestionTimer();
  // save score
  saveScore(playerName, score);
  updateLeaderboard();
  // show final toast
  showCenterToast(`Trò chơi kết thúc`, `Bạn: ${playerName} — Điểm: ${score}`, true, 8);
  // stop bgm? keep playing — up to bạn. currently we'll keep playing.
}

/* ===========================
   Init
   =========================== */
(function init(){
  // prepare background slideshow
  startSlideshow();

  // initial UI: disable answer box until player starts
  answerInput.disabled = true;
  answerBtn.disabled = false; // but it won't work until player logs in

  // timer display initial
  timerDisplay.textContent = `⏳ ${TIME_PER_QUESTION}s`;

  updateUI();
  updateLeaderboard();

  // prepare bgm (but don't play until user clicks "Bắt đầu")
  initBgm();

  // resume audio context on first user gesture (some browsers)
  function resumeAudioOnGesture(){
    if(audioCtx && audioCtx.state === 'suspended'){ audioCtx.resume().catch(()=>{}); }
    document.removeEventListener('click', resumeAudioOnGesture);
  }
  document.addEventListener('click', resumeAudioOnGesture);
})();
</script>
</body>
</html>


